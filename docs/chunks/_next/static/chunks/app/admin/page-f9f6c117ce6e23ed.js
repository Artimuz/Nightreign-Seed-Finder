(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{3271:(e,t,r)=>{"use strict";r.d(t,{default:()=>c});var s=r(5155),a=r(2115),n=r(6066);let i="nightreign_version_check",l=n.h;function c(){let{currentVersion:e,serverVersion:t,lastChecked:r,isChecking:n,error:c,timeUntilNextCheck:o,checkVersion:d}=function(){let[e,t]=(0,a.useState)({currentVersion:l,serverVersion:null,needsUpdate:!1,lastChecked:null,isChecking:!1,error:null,versionHistory:[],latestFeatures:[]}),r=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{t(e=>({...e,isChecking:!0,error:null}));let r=new URLSearchParams({client_version:l,...e&&{detailed:"true"}}),s=await fetch("/api/version?".concat(r));if(!s.ok)throw Error("HTTP ".concat(s.status));let a=await s.json();t(e=>({...e,serverVersion:a.version,needsUpdate:a.needs_update,lastChecked:Date.now(),isChecking:!1,versionHistory:a.version_history||e.versionHistory,latestFeatures:a.latest_features||e.latestFeatures}));let n={lastChecked:Date.now(),serverVersion:a.version,needsUpdate:a.needs_update};return localStorage.setItem(i,JSON.stringify(n)),a}catch(r){let e=r instanceof Error?r.message:"Version check failed";throw t(t=>({...t,isChecking:!1,error:e})),r}},[]),s=(0,a.useCallback)(()=>{try{let e=localStorage.getItem(i);if(!e)return!0;let{lastChecked:t}=JSON.parse(e);return Date.now()-t>36e5}catch(e){return!0}},[]),n=(0,a.useCallback)(()=>{try{let e=localStorage.getItem(i);if(e){let r=JSON.parse(e);t(e=>({...e,serverVersion:r.serverVersion,needsUpdate:r.needsUpdate,lastChecked:r.lastChecked}))}}catch(e){}},[]),c=(0,a.useCallback)(()=>r(!0),[r]),o=(0,a.useCallback)(()=>{t(e=>({...e,needsUpdate:!1}));try{let e=localStorage.getItem(i);if(e){let t=JSON.parse(e);t.needsUpdate=!1,localStorage.setItem(i,JSON.stringify(t))}}catch(e){}},[]),d=(0,a.useMemo)(()=>e.lastChecked?Math.max(0,36e5-(Date.now()-e.lastChecked)):0,[e.lastChecked]);return(0,a.useEffect)(()=>{n();let t=Date.now(),a=0,l=async t=>{s()&&(e.isChecking||await r(t))},c=(()=>{let e=localStorage.getItem(i),r=e?JSON.parse(e).lastChecked:void 0,s=Math.max(1500,36e5-(Date.now()-("number"==typeof r?r:t)));return window.setTimeout(()=>{l(!1)},s)})(),o=()=>{if("visible"!==document.visibilityState)return;let e=Date.now();e-a<3e5||(a=e,l(!1))},d=()=>{let e=Date.now();e-a<3e5||(a=e,l(!1))};return document.addEventListener("visibilitychange",o),window.addEventListener("focus",d),l(!1),()=>{window.clearTimeout(c),document.removeEventListener("visibilitychange",o),window.removeEventListener("focus",d)}},[r,s,n,e.isChecking]),{...e,checkVersion:c,clearUpdateFlag:o,timeUntilNextCheck:d}}();return(0,s.jsx)("div",{className:"fixed bottom-4 left-4 z-40",children:(0,s.jsx)("div",{className:"bg-black/80 text-white text-xs p-2 rounded backdrop-blur-sm",children:(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{children:["Version: ",e]}),t&&(0,s.jsxs)("div",{children:["Server: ",t]}),r&&(0,s.jsxs)("div",{children:["Last check: ",new Date(r).toLocaleTimeString()]}),o>0&&(0,s.jsxs)("div",{children:["Next check: ",(e=>{let t=Math.floor(e/6e4),r=Math.floor(e%6e4/1e3);return"".concat(t,":").concat(r.toString().padStart(2,"0"))})(o)]}),n&&(0,s.jsx)("div",{className:"text-blue-400",children:"Checking..."}),c&&(0,s.jsxs)("div",{className:"text-red-400",children:["Error: ",c]}),(0,s.jsx)("button",{onClick:d,disabled:n,className:"text-blue-400 hover:text-blue-300 disabled:opacity-50",children:"Check Now"})]})})})}},5325:(e,t,r)=>{Promise.resolve().then(r.bind(r,3271))},6066:(e,t,r)=>{"use strict";r.d(t,{h:()=>s});let s="1.2.17"}},e=>{e.O(0,[441,255,358],()=>e(e.s=5325)),_N_E=e.O()}]);